# 装饰器

## 概述

> 面向对象的概念(java;注解，c#：特征)，decorator
> angular 大量使用 react也会用到
> 目前js支持装饰器 目前处于建议征集的第二阶段

### 解决的问题

装饰器，分离关注点

- 信息书写位置的问题：在定义某个东西时，应该最清楚该东西的情况。
- 重复代码的问题

以上问题产生的根源：某些信息在定义的时候能够附加的信息量有限。

装饰器的作用：为某些属性 类 参数 方法 提供元数据信息（metadata）

元数据：描述数据的数据

### 装饰器的本质

在JS中，装饰器是一个函数。因此装饰器是要参与运行的。

装饰器可以修饰

- 类
- 成员（属性和方法）
- 参数

## 类装饰器

类装饰器的本质是一个函数，该函数接受一个参数，表示类本身（构造函数本身）

使用装饰器```@得到一个函数```

在TS中，如何约束一个变量为类

- Function
- ```new(参数)=>object```

装饰器函数的运行时间点：在类定义后直接运行

类装饰器可以具有的返回值：

- void：仅运行函数
- 返回一个新的类：会将新的类替换掉装饰目标

多个装饰器的情况：

- 会按照后加入先调用的顺序进行调用

## 成员(类的)装饰器

- 属性
  属性装饰器也是一个函数，该函数需要两个参数：
1. 如果是静态属性 则为类本身；如果是实例属性，则为类的原型
2. 固定为一个字符串 表示为属性名
- 方法
方法装饰器也是一个函数，该函数需要三个参数：
1. 如果是静态方法 则为类本身；如果是实例方法，则为类的原型
2. 固定为一个字符串 表示为方法名
3. 描述符对象

## reflect-metadata库

地址:https://www.npmjs.com/package/reflect-metadata

作用：保存元数据

## class-validator库 class-transformer库

>不错的库

## 装饰器补充

- 参数装饰器
  - 依赖注入 依赖倒置
  - 三个参数
    - 如果方法是静态的，则为类本身；如果方法是实例方法，则为类的原型
    - 方法名称
    - index 参数索引
- 关于TS自动注入的元数据
  - 如果安装了```Reflect-metadata``` 并且导入了该库，并且在某个成员上添加了元数据，并且启用了```emitDecoratorMetadata```,TS在编译结果中，将会约束该类型，作为元数据加入到相应位置
  - 这样一来，TS的类型检查（约束）可以有机会在运行时进行
- AOP （编程方式）
  
属于面向对象开发

将一些在业务中共同出现的功能块，横向切分，以达到分离关注点的目的。

